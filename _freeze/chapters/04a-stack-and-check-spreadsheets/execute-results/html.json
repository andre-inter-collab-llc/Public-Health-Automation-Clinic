{
  "hash": "e9e3ca5dc62ff2e5bb88126bd4cec726",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Combine and Compare Spreadsheets\"\n---\n\n# The Problem\n\nPublic health teams frequently distribute Excel-based data collection forms to multiple sites, facilities, or respondents. A common workflow looks like this: a program coordinator creates a standardized spreadsheet template, emails it to ten county offices, and asks each office to fill in their data and return it. Sometimes the spreadsheets are stored in a shared folder instead. Either way, the coordinator eventually needs to combine all responses into a single dataset for analysis.\n\nThis process breaks down in predictable ways:\n\n- **Column headers get renamed.** One site changes \"date_of_diagnosis\" to \"dx_date.\" Another adds a space. A third capitalizes it differently.\n- **Columns are added or removed.** A site inserts an extra column for local tracking, or deletes a column they consider irrelevant.\n- **Sheet names differ.** The template uses \"Data Entry\" but a respondent renames the tab to \"Sheet1.\"\n- **Manual merging is tedious and error-prone.** Copy-pasting rows from ten spreadsheets into a master file can take hours and risks misaligned columns, dropped records, or duplicated data.\n\nThe coordinator may then try to analyze the combined data in Excel or R, only to discover that the structural inconsistencies have created problems downstream: mismatched column counts, unexpected blanks, or silently misaligned values.\n\n::: {.callout-important title=\"Why Not Use a Proper Data Collection Tool?\"}\nIf you have the option, a structured data collection platform like [REDCap](https://www.project-redcap.org/){target=\"_blank\"}, [KoBoToolbox](https://www.kobotoolbox.org/){target=\"_blank\"}, or even [Google Forms](https://www.google.com/forms/about/){target=\"_blank\"} is almost always preferable to distributing Excel templates. These tools enforce field types, validation rules, and consistent structure at the point of entry, eliminating the column mismatch problem entirely.\n\nHowever, many public health teams still end up with spreadsheets for practical reasons:\n\n- **No access to REDCap or similar tools.** Not every organization has a REDCap instance, and setting one up requires server infrastructure and IRB coordination.\n- **Speed of setup.** Creating an Excel template and emailing it takes minutes. Configuring a REDCap instrument with branching logic and validation can take days.\n- **Existing systems export spreadsheets.** Cancer registries, laboratory information systems, EHR extracts, and surveillance platforms often produce Excel or CSV exports as their standard output format. The data was never \"collected\" in a spreadsheet; it was generated by another system.\n- **External partners use Excel.** When collecting data from facilities, providers, or agencies outside your organization, you often cannot dictate the tool. You get what you get.\n- **One-time or ad-hoc collections.** For a quick data call that will only happen once, the overhead of setting up a formal data collection instrument may not be justified.\n\nThis tool is designed for those situations: when spreadsheets are the reality, whether by choice or by circumstance.\n:::\n\n## The Scale of the Problem\n\nConsider a state cancer registry that collects annual data submissions from 88 county health departments using a standardized Excel template. Each year, staff must:\n\n1. Download or receive 88 completed workbooks\n2. Open each one to verify the correct sheet exists\n3. Check that column headers match the template\n4. Copy and paste (or append) the data into a master file\n5. Troubleshoot the files that do not match\n\nAt 5 to 10 minutes per file, this is 7 to 15 hours of manual work, repeated every reporting cycle. And that estimate assumes nothing goes wrong.\n\n# The Solution\n\nThe **Combine & Compare Spreadsheets** app is a Shiny web application that automates this entire workflow. Upload your spreadsheets, click a button, and get:\n\n- A **combined dataset** with a source file column tracking which record came from which file\n- A **column comparison matrix** showing exactly which columns appear in which files, making structural differences immediately visible\n- A **file issues report** listing any files with missing sheets, read errors, or empty data\n- An **interactive pivot table** for exploring the combined data\n- A **branded Excel download** containing all analysis sheets\n\nThe app supports `.xlsx`, `.xls`, and `.csv` files, and can handle mixed file types in a single upload.\n\n## Why This App Exists\n\nOver the past 20 years, I have watched colleagues across public health programs wrestle with this exact task: merging a pile of returned spreadsheets into a single, usable dataset. I have also received enough requests to perform this merge myself that the pattern became impossible to ignore. The task is universal, the pain is real, and the solution is straightforward to automate.\n\nI built this app so that I can share it with colleagues who have little or no programming experience. Rather than walking someone through an R script or doing the merge for them, I can point them to this tool and let them handle it independently.\n\n::: {.callout-note title=\"A Note on GUI Apps and Automation\"}\nIn general, I do not recommend using GUI applications for automated workflows. If a task is recurring, the better investment is a scripted pipeline that runs without manual interaction. However, a point-and-click app like this one earns its place in two situations:\n\n- **Truly one-off requests.** Sometimes you receive a batch of spreadsheets once and will never repeat the exercise. Setting up a project directory, writing a script, and configuring outputs is not justified for a single use.\n- **Quick pre-project checks.** Before committing to a full data pipeline, you may want to take a first look at received files: Are the columns consistent? Are there empty submissions? How many records came back? This app provides that structural overview in seconds, helping you decide how to proceed.\n\nFor anything that will be repeated on a schedule, build a script.\n:::\n\n## Why Local-First Sharing?\n\n[Shiny](https://shiny.posit.co/){target=\"_blank\"} applications can be shared in [several ways](https://shiny.posit.co/r/getstarted/shiny-basics/lesson7/){target=\"_blank\"}: as hosted web applications on [shinyapps.io](https://www.shinyapps.io/){target=\"_blank\"}, on a [Shiny Server](https://posit.co/products/open-source/shinyserver/){target=\"_blank\"}, or as source files that users run locally. I explicitly chose local-first distribution for this app because of the data it handles.\n\nPublic health spreadsheets frequently contain protected health information (PHI), personally identifiable information (PII), or other sensitive data. Hosting this app as a public webpage would invite users to upload that data to an external server, which creates unnecessary risk and may violate organizational data governance policies. By distributing the app as source code that runs on the user's own machine, no data ever leaves the local environment.\n\n::: {.callout-tip title=\"Hosting with Posit Connect\"}\nIf your organization wants to make this app available to a team internally, [Posit Connect](https://posit.co/products/enterprise/connect/){target=\"_blank\"} is a publishing platform that supports Shiny applications with enterprise features:\n\n- Password authentication\n- SSL support\n- Administrator tools\n- Priority support\n\nPosit Connect allows you to publish Shiny applications, R Markdown reports, dashboards, Jupyter Notebooks, and more in a centralized, access-controlled environment. You can publish directly from the RStudio IDE and configure flexible security policies to control who can access the app.\n\nThis is a good option for teams working in a for-profit or regulated setting where centralized access control and audit trails are required. Learn more at [posit.co/products/enterprise/connect](https://posit.co/products/enterprise/connect/){target=\"_blank\"}.\n:::\n\n## User Story\n\n> **As a** public health data coordinator who collects Excel-based data from multiple sites,\n> **I want** a tool that automatically combines spreadsheets and flags structural differences,\n> **so that** I can spend my time on analysis instead of copy-pasting and troubleshooting column mismatches.\n\n## GPS (Given-Person-Should)\n\n> **Given** a set of Excel workbooks returned by multiple respondents using a common template,\n> **the** data coordinator **should** upload them to the Combine & Compare app and review the column comparison matrix\n> **to** identify and resolve structural inconsistencies before combining the data for analysis.\n\n# Getting Started\n\n## Download the App\n\nThe app is available in the Public Health Automation Clinic GitHub repository:\n\n1. **Download the app folder** from the repository:\n   - Go to [github.com/andre-inter-collab-llc/Public-Health-Automation-Clinic](https://github.com/andre-inter-collab-llc/Public-Health-Automation-Clinic){target=\"_blank\"}\n   - Navigate to `apps/combine-and-compare-spreadsheets/`\n   - Download the entire folder (or clone the full repository)\n\n2. **Clone the full repository** (recommended if you use Git):\n\n```bash\ngit clone https://github.com/andre-inter-collab-llc/Public-Health-Automation-Clinic.git\n```\n\nThe app files are located at `apps/combine-and-compare-spreadsheets/` within the repository.\n\n## Install Requirements\n\nThe app requires [R](https://cran.r-project.org/){target=\"_blank\"} (version 4.1 or later) and the following packages:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\ninstall.packages(c(\n  \"shiny\",\n  \"bslib\",\n  \"readxl\",\n  \"dplyr\",\n  \"janitor\",\n  \"openxlsx\",\n  \"DT\",\n  \"tidyr\",\n  \"purrr\",\n  \"tibble\",\n  \"rpivotTable\"\n))\n```\n:::\n\n\n[RStudio Desktop](https://posit.co/download/rstudio-desktop/){target=\"_blank\"} (free) is the recommended IDE for running the app, though any R environment will work.\n\n## Run the App\n\nOpen `app.R` in RStudio and click **Run App**, or run the following from an R console:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"false\"}\nshiny::runApp(here::here(\"apps\", \"combine-and-compare-spreadsheets\"))\n```\n:::\n\n\nThe app will open in your default web browser. Everything runs locally on your machine; no data leaves your computer.\n\n![The About page introduces the app, explains its purpose, and lists the key features.](../assets/images/04a-combine-compare/01-about-page.png){fig-alt=\"Screenshot of the Combine and Compare Spreadsheets app About page showing the app description and feature overview.\"}\n\n# How to Use the App\n\n## Step 1: Upload Files\n\nClick **Upload Spreadsheets** in the sidebar and select one or more Excel (`.xlsx`, `.xls`) or CSV (`.csv`) files. You can upload a mix of file types in a single batch.\n\n![The Workbench tab before any files are uploaded, showing the file upload area and processing controls.](../assets/images/04a-combine-compare/02-workbench-empty.png){fig-alt=\"Screenshot of the empty Workbench tab with the file upload control and processing options visible in the sidebar.\"}\n\n## Step 2: Select Sheet Name\n\nFor Excel files, the app reads all available sheet names across uploaded workbooks and presents them in a dropdown. Select the sheet containing the data you want to combine. CSV files do not require sheet selection.\n\n## Step 3: Set the Header Row\n\nIf your spreadsheets have title rows, instructions, or logos above the actual column headers, set the **Header Row** to the row number where headers appear. The default is row 1.\n\n![After uploading five county spreadsheets, the sidebar shows the selected sheet name and header row settings.](../assets/images/04a-combine-compare/03-files-uploaded.png){fig-alt=\"Screenshot showing five uploaded Excel files listed in the sidebar with sheet name dropdown and header row selector.\"}\n\n## Step 4: Process Files\n\nClick **Process Files**. The app will:\n\n1. Read data from each file using the selected sheet name and header row\n2. Clean and standardize column names (lowercase, underscores, consistent formatting)\n3. Add a `source_file` column to track the origin of each record\n4. Combine all data into a single dataset\n5. Build a column comparison matrix\n6. Log any file issues (missing sheets, read errors, empty data)\n\nA progress bar shows status during processing.\n\n## Step 5: Review Results\n\nThe Workbench tab provides four views:\n\n### Combined Data\n\nThe full merged dataset with all records from all files. Use the column filters to search and sort. The `source_file` column identifies which file each record came from.\n\n![The Combined Data view showing all records merged into a single table with the source_file column.](../assets/images/04a-combine-compare/04-combined-data.png){fig-alt=\"Screenshot of the Combined Data tab displaying a merged dataset with columns from all uploaded files and a source_file tracking column.\"}\n\n### Column Comparison\n\nThe Column Comparison tab contains three sub-views, designed to scale from a handful of files to hundreds:\n\n#### Discrepancies Only\n\nThe default and most compact view. Shows **only columns that are not present in every file**. For each mismatched column you can see:\n\n- How many files contain it and how many are missing it\n- The percentage of files where it appears\n- The exact filenames that are missing the column\n\nIf all files have identical column structures, this view shows a green \"no discrepancies\" message and an empty table. This is the view to check first: if it is empty, your data is structurally consistent and you can proceed directly to analysis.\n\n![The Discrepancies Only view highlighting columns that are not present in every file.](../assets/images/04a-combine-compare/05-discrepancies.png){fig-alt=\"Screenshot of the Discrepancies Only sub-tab showing a table of columns with mismatches across files, including file counts and missing file names.\"}\n\n#### Full Matrix\n\nA complete presence/absence matrix with **files as rows** and **column names as headers**:\n\n- **✓** (teal) indicates the column is present in that file\n- **✗** (red) indicates the column is missing from that file\n- The `columns_present` and `columns_missing` summary columns appear at the end of each row\n- The file column is frozen so it stays visible while scrolling horizontally\n- Files with more missing columns sort to the top\n\nThis layout scales better than column-per-file because typical datasets have 10 to 50 columns (manageable as table headers) while file counts can grow to hundreds or thousands (which work well as scrollable rows). For very large uploads, use the Excel download to filter and search the matrix in Excel.\n\n![The Full Matrix view with files as rows and columns as headers, using check marks and X marks to show presence and absence.](../assets/images/04a-combine-compare/06-full-matrix.png){fig-alt=\"Screenshot of the Full Matrix sub-tab showing a file-by-column presence/absence grid with teal check marks and red X marks.\"}\n\n#### File Profiles\n\nA per-file summary showing:\n\n| Column | Meaning |\n|:-------|:--------|\n| Rows | Number of data rows in the file |\n| Columns | Number of columns in the file |\n| Expected | Number of \"expected\" columns (those present in more than half of all files) |\n| Missing | How many expected columns are absent from this file |\n| Missing Columns | Semicolon-separated list of which expected columns are missing |\n| Extra | How many columns this file has that are not in the expected set |\n| Extra Columns | Semicolon-separated list of non-standard columns added to this file |\n\nFiles with more missing or extra columns sort to the top, making it easy to spot outliers that need manual correction before analysis.\n\n![The File Profiles view summarizing each file's row count, column count, and any missing or extra columns.](../assets/images/04a-combine-compare/07-file-profiles.png){fig-alt=\"Screenshot of the File Profiles sub-tab showing a per-file summary table with rows, columns, expected, missing, and extra column counts.\"}\n\n### File Issues\n\nThis tab is separate from column discrepancies. It lists files that **could not be processed at all**:\n\n| Issue Type | Meaning |\n|:-----------|:--------|\n| Missing Sheet | The selected sheet name was not found in the workbook |\n| Read Error | The file could not be read (corrupt, password-protected, or unsupported format) |\n| Empty Data | The file or sheet contained no data rows after the header |\n\nIf all files processed successfully, this tab shows \"All files processed successfully.\" Files listed here are excluded from the combined dataset and from the column comparison.\n\n![The File Issues tab listing files that could not be processed, with issue type descriptions.](../assets/images/04a-combine-compare/08-file-issues.png){fig-alt=\"Screenshot of the File Issues tab showing a table of files with processing problems such as missing sheets or read errors.\"}\n\n### Explore Data\n\nAn interactive pivot table ([rpivotTable](https://github.com/smartinsightsfromdata/rpivotTable){target=\"_blank\"}) for ad-hoc exploration of the combined data. Drag columns into rows, columns, or filters to create cross-tabulations, charts, and summaries without writing code.\n\n![The Explore Data tab with an interactive pivot table for ad-hoc analysis of the combined dataset.](../assets/images/04a-combine-compare/09-explore-data.png){fig-alt=\"Screenshot of the Explore Data tab showing the rpivotTable interface with drag-and-drop column fields for building cross-tabulations.\"}\n\n## Step 6: Download\n\nClick **Download Combined XLSX** to export a formatted Excel workbook with five sheets:\n\n1. **Combined Data**: the full merged dataset\n2. **Discrepancies**: only the mismatched columns (empty if all files match)\n3. **Column Matrix**: the full file-by-column presence/absence matrix\n4. **File Profiles**: per-file row/column counts with missing and extra columns listed\n5. **File Issues**: the processing issue log\n\nThe workbook uses professional formatting with styled headers. The **Discrepancies** and **File Profiles** sheets are particularly useful for filtering and searching in Excel when dealing with hundreds of files.\n\n# Supported File Formats\n\n| Format | Extension | Notes |\n|:-------|:----------|:------|\n| Excel (modern) | `.xlsx` | Full support including sheet selection |\n| Excel (legacy) | `.xls` | Full support including sheet selection |\n| CSV | `.csv` | Sheet selection is not applicable |\n\nMixed file types can be uploaded together. For example, you can upload eight `.xlsx` files and two `.csv` files in the same batch.\n\n# Tips and Best Practices\n\n::: {.callout-tip title=\"Preventing Problems at the Source\"}\nThe best way to handle column mismatches is to prevent them. When distributing data collection templates:\n\n- **Lock the header row** in Excel (Review > Protect Sheet, allow only data entry in the data range)\n- **Use data validation** on key columns to constrain inputs\n- **Name your sheets consistently** and include instructions not to rename them\n- **Include a \"do not modify\" note** in the template header\n\nThe Combine & Compare app is most valuable when prevention was not possible, which, in practice, is most of the time.\n:::\n\n::: {.callout-tip title=\"Large File Uploads\"}\nThe app supports uploads up to 100 MB total. For very large collections of spreadsheets, consider processing them in batches and combining the downloaded outputs.\n:::\n\n::: {.callout-note title=\"Local-First\"}\nThis app runs entirely on your local machine. No data is uploaded to external servers. This makes it suitable for use with protected health information (PHI) and other sensitive data, subject to your organization's policies for running local software.\n:::\n",
    "supporting": [
      "04a-combine-compare-spreadsheets_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}